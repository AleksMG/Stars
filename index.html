<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вращение звезды при коллапсе</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0f0f1a;
            color: #fff;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .controls {
            flex: 1;
            min-width: 300px;
            background: #1a1a2e;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .simulation {
            flex: 2;
            min-width: 500px;
            height: 600px;
            background: #000;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0,100,255,0.3);
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        h1 {
            color: #4fc3f7;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(79,195,247,0.5);
        }
        .control-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #4fc3f7;
            font-weight: bold;
        }
        input[type="range"] {
            width: 100%;
            height: 10px;
            background: #333;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #4fc3f7;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(79,195,247,0.8);
        }
        .value-display {
            display: inline-block;
            margin-top: 5px;
            padding: 3px 8px;
            background: rgba(79,195,247,0.2);
            border-radius: 5px;
            font-family: monospace;
        }
        button {
            background: linear-gradient(135deg, #4fc3f7, #2196f3);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 0 0;
            transition: all 0.3s;
            box-shadow: 0 0 10px rgba(33,150,243,0.5);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(33,150,243,0.8);
        }
        .info-panel {
            margin-top: 20px;
            padding: 15px;
            background: rgba(26,35,46,0.7);
            border-radius: 10px;
            border-left: 4px solid #4fc3f7;
        }
        .info-item {
            margin: 8px 0;
        }
        .info-label {
            color: #4fc3f7;
            font-weight: bold;
        }
        .rotation-indicator {
            margin-top: 20px;
            height: 5px;
            background: linear-gradient(90deg, #f44336, #ff9800, #4caf50, #2196f3, #9c27b0);
            border-radius: 5px;
            position: relative;
        }
        .rotation-marker {
            position: absolute;
            top: -5px;
            width: 15px;
            height: 15px;
            background: #fff;
            border-radius: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 10px #fff;
        }
    </style>
</head>
<body>
    <h1>★ Визуализация вращения звезды при коллапсе ★</h1>
    
    <div class="container">
        <div class="controls">
            <div class="control-group">
                <label for="initialMass">Масса звезды (M☉): <span class="value-display" id="initialMassValue">10</span></label>
                <input type="range" id="initialMass" min="0.1" max="100" step="0.1" value="10">
            </div>
            
            <div class="control-group">
                <label for="initialRadius">Радиус (R☉): <span class="value-display" id="initialRadiusValue">5</span></label>
                <input type="range" id="initialRadius" min="0.1" max="20" step="0.1" value="5">
            </div>
            
            <div class="control-group">
                <label for="rotationSpeed">Вращение (об/день): <span class="value-display" id="rotationSpeedValue">1</span></label>
                <input type="range" id="rotationSpeed" min="0.01" max="1000" step="0.01" value="1">
                <div class="rotation-indicator">
                    <div class="rotation-marker" id="rotationMarker"></div>
                </div>
            </div>
            
            <div class="control-group">
                <label for="collapseFactor">Степень коллапса: <span class="value-display" id="collapseFactorValue">100x</span></label>
                <input type="range" id="collapseFactor" min="10" max="100000" step="10" value="100">
            </div>
            
            <button id="startBtn">▶ Запуск</button>
            <button id="pauseBtn">⏸ Пауза</button>
            <button id="resetBtn">⏹ Сброс</button>
            
            <div class="info-panel">
                <div class="info-item">
                    <span class="info-label">Текущая скорость:</span>
                    <span id="currentRotation">1 об/день</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Финальная скорость:</span>
                    <span id="finalRotation">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Увеличение скорости:</span>
                    <span id="speedIncrease">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Тип остатка:</span>
                    <span id="remnantType">-</span>
                </div>
            </div>
        </div>
        
        <div class="simulation">
            <canvas id="starCanvas"></canvas>
        </div>
    </div>

    <script>
        // Физические константы
        const SOLAR_MASS = 1.989e30; // кг
        const SOLAR_RADIUS = 695700; // км
        const G = 6.67430e-11; // гравитационная постоянная
        const DAY_SECONDS = 86400;
        
        // Настройка canvas
        const canvas = document.getElementById('starCanvas');
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // Элементы управления
        const initialMassSlider = document.getElementById('initialMass');
        const initialRadiusSlider = document.getElementById('initialRadius');
        const rotationSpeedSlider = document.getElementById('rotationSpeed');
        const collapseFactorSlider = document.getElementById('collapseFactor');
        
        const initialMassValue = document.getElementById('initialMassValue');
        const initialRadiusValue = document.getElementById('initialRadiusValue');
        const rotationSpeedValue = document.getElementById('rotationSpeedValue');
        const collapseFactorValue = document.getElementById('collapseFactorValue');
        const rotationMarker = document.getElementById('rotationMarker');
        
        const currentRotationDisplay = document.getElementById('currentRotation');
        const finalRotationDisplay = document.getElementById('finalRotation');
        const speedIncreaseDisplay = document.getElementById('speedIncrease');
        const remnantTypeDisplay = document.getElementById('remnantType');
        
        // Параметры симуляции
        let animationId = null;
        let simulationTime = 0;
        let isSimulating = false;
        let isPaused = false;
        
        // Параметры звезды
        let star = {
            mass: 10,
            radius: 5,
            rotationSpeed: 1, // об/день
            angularVelocity: 0,
            color: [255, 200, 100],
            flattening: 0
        };
        
        // Параметры остатка
        let remnant = {
            radius: 0,
            rotationSpeed: 0,
            angularVelocity: 0,
            color: [100, 150, 255],
            type: ''
        };
        
        // Обновление отображаемых значений
        function updateSliderValues() {
            initialMassValue.textContent = initialMassSlider.value;
            initialRadiusValue.textContent = initialRadiusSlider.value;
            
            const rotationSpeed = parseFloat(rotationSpeedSlider.value);
            rotationSpeedValue.textContent = rotationSpeed < 1 ? 
                rotationSpeed.toExponential(2) : 
                rotationSpeed.toFixed(2);
            
            // Позиция маркера вращения
            const speedPercent = Math.log10(rotationSpeed + 1) / Math.log10(1001) * 100;
            rotationMarker.style.left = `${speedPercent}%`;
            
            collapseFactorValue.textContent = `${collapseFactorSlider.value}x`;
        }
        
        // Применение значений из слайдеров
        function applySliderValues() {
            star.mass = parseFloat(initialMassSlider.value);
            star.radius = parseFloat(initialRadiusSlider.value);
            star.rotationSpeed = parseFloat(rotationSpeedSlider.value);
            star.angularVelocity = star.rotationSpeed * 2 * Math.PI / DAY_SECONDS;
            
            // Эллиптичность из-за вращения
            star.flattening = Math.min(0.4, star.rotationSpeed * 0.01);
            
            updateSliderValues();
        }
        
        // Определение типа остатка
        function determineRemnantType(mass) {
            if (mass < 1.4) return 'Белый карлик';
            if (mass < 3) return 'Нейтронная звезда';
            return 'Черная дыра';
        }
        
        // Расчет параметров после коллапса
        function calculateRemnant() {
            const collapseFactor = parseFloat(collapseFactorSlider.value);
            remnant.radius = star.radius / collapseFactor;
            
            // Сохранение момента импульса (I1ω1 = I2ω2)
            // Для сферы I ~ MR², но учитываем уплощение
            const initialMoment = star.mass * Math.pow(star.radius * (1 - star.flattening), 2) * star.angularVelocity;
            remnant.angularVelocity = initialMoment / (star.mass * Math.pow(remnant.radius, 2));
            remnant.rotationSpeed = remnant.angularVelocity * DAY_SECONDS / (2 * Math.PI);
            
            // Ограничение скорости для нейтронных звезд (не может превышать ~1000 об/с)
            if (remnant.rotationSpeed > 1000 * DAY_SECONDS) {
                remnant.rotationSpeed = 1000 * DAY_SECONDS;
                remnant.angularVelocity = remnant.rotationSpeed * 2 * Math.PI / DAY_SECONDS;
            }
            
            remnant.type = determineRemnantType(star.mass);
            
            // Цвет остатка
            if (remnant.type === 'Белый карлик') {
                remnant.color = [200, 220, 255];
            } else if (remnant.type === 'Нейтронная звезда') {
                remnant.color = [100, 150, 255];
            } else {
                remnant.color = [50, 50, 80];
            }
            
            // Обновление информации
            finalRotationDisplay.textContent = remnant.rotationSpeed.toExponential(2) + ' об/день';
            speedIncreaseDisplay.textContent = (remnant.rotationSpeed / star.rotationSpeed).toExponential(2) + 'x';
            remnantTypeDisplay.textContent = remnant.type;
        }
        
        // Рисование вращающейся звезды
        function drawRotatingStar(x, y, radius, color, rotationAngle, flattening = 0, isRemnant = false) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotationAngle);
            
            // Эллипс с учетом уплощения
            const verticalRadius = radius * (1 - flattening);
            
            // Градиент
            const gradient = ctx.createRadialGradient(
                0, 0, 0,
                0, 0, radius
            );
            gradient.addColorStop(0, `rgba(${color[0]}, ${color[1]}, ${color[2]}, 1)`);
            gradient.addColorStop(1, `rgba(${color[0]*0.5}, ${color[1]*0.5}, ${color[2]*0.5}, 1)`);
            
            // Рисуем эллипс
            ctx.beginPath();
            ctx.ellipse(0, 0, radius, verticalRadius, 0, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();
            
            // Для нейтронной звезды добавляем пучки излучения
            if (isRemnant && remnant.type === 'Нейтронная звезда') {
                const pulseIntensity = 0.7 + 0.3 * Math.sin(simulationTime * 10);
                
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(radius * 5, -radius * 0.7);
                ctx.lineTo(radius * 5, radius * 0.7);
                ctx.closePath();
                ctx.fillStyle = `rgba(255, 255, 255, ${pulseIntensity})`;
                ctx.fill();
                
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(-radius * 5, -radius * 0.7);
                ctx.lineTo(-radius * 5, radius * 0.7);
                ctx.closePath();
                ctx.fillStyle = `rgba(255, 255, 255, ${pulseIntensity})`;
                ctx.fill();
            }
            
            // Для черной дыры добавляем аккреционный диск
            if (isRemnant && remnant.type === 'Черная дыра') {
                ctx.beginPath();
                ctx.ellipse(0, 0, radius * 3, radius * 1.5, 0, 0, Math.PI * 2);
                const diskGradient = ctx.createLinearGradient(-radius * 3, 0, radius * 3, 0);
                diskGradient.addColorStop(0, 'rgba(200, 200, 255, 0.1)');
                diskGradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.3)');
                diskGradient.addColorStop(1, 'rgba(200, 200, 255, 0.1)');
                ctx.fillStyle = diskGradient;
                ctx.fill();
            }
            
            ctx.restore();
        }
        
        // Рисование фона
        function drawBackground() {
            // Космический фон
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Звезды
            for (let i = 0; i < 100; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const size = Math.random() * 2;
                const brightness = Math.random() * 200 + 55;
                
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fillStyle = `rgb(${brightness}, ${brightness}, ${brightness})`;
                ctx.fill();
            }
        }
        
        // Анимация
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const maxRadius = Math.min(canvas.width, canvas.height) * 0.4;
            
            // Прогресс анимации (0-1)
            const animationDuration = 5; // секунд
            const progress = Math.min(simulationTime / animationDuration, 1);
            
            // Интерполяция параметров
            let currentRadius, currentColor, currentFlattening, rotationAngle;
            let isRemnant = false;
            
            if (progress < 0.3) {
                // Фаза до коллапса
                const phaseProgress = progress / 0.3;
                currentRadius = star.radius * (1 - phaseProgress * 0.1); // небольшое сжатие
                currentColor = star.color;
                currentFlattening = star.flattening;
                rotationAngle = star.angularVelocity * simulationTime;
                
                // Показываем текущую скорость вращения
                currentRotationDisplay.textContent = star.rotationSpeed.toFixed(2) + ' об/день';
            } else if (progress < 0.8) {
                // Фаза коллапса
                const phaseProgress = (progress - 0.3) / 0.5;
                currentRadius = star.radius * 0.9 * (1 - phaseProgress) + remnant.radius * phaseProgress;
                
                // Интерполяция цвета
                currentColor = [
                    star.color[0] * (1 - phaseProgress) + remnant.color[0] * phaseProgress,
                    star.color[1] * (1 - phaseProgress) + remnant.color[1] * phaseProgress,
                    star.color[2] * (1 - phaseProgress) + remnant.color[2] * phaseProgress
                ];
                
                // Уменьшение уплощения
                currentFlattening = star.flattening * (1 - phaseProgress);
                
                // Интерполяция скорости вращения
                const currentAngularVelocity = star.angularVelocity * (1 - phaseProgress) + 
                                             remnant.angularVelocity * phaseProgress;
                rotationAngle = star.angularVelocity * 0.3 * animationDuration + 
                               currentAngularVelocity * (simulationTime - 0.3 * animationDuration);
                
                // Показываем текущую скорость вращения
                const currentRotationSpeed = currentAngularVelocity * DAY_SECONDS / (2 * Math.PI);
                currentRotationDisplay.textContent = currentRotationSpeed.toExponential(2) + ' об/день';
                
                // Эффект вспышки при коллапсе
                if (phaseProgress > 0.4 && phaseProgress < 0.6) {
                    const flashIntensity = Math.sin((phaseProgress - 0.4) * Math.PI / 0.2) * 0.7;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, currentRadius * 10, 0, Math.PI * 2);
                    const gradient = ctx.createRadialGradient(
                        centerX, centerY, currentRadius,
                        centerX, centerY, currentRadius * 10
                    );
                    gradient.addColorStop(0, `rgba(255, 255, 255, ${flashIntensity})`);
                    gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                    ctx.fillStyle = gradient;
                    ctx.fill();
                }
            } else {
                // Фаза после коллапса
                currentRadius = remnant.radius;
                currentColor = remnant.color;
                currentFlattening = 0;
                rotationAngle = star.angularVelocity * 0.3 * animationDuration + 
                              remnant.angularVelocity * (simulationTime - 0.3 * animationDuration);
                isRemnant = true;
                
                // Показываем финальную скорость вращения
                currentRotationDisplay.textContent = remnant.rotationSpeed.toExponential(2) + ' об/день';
                
                // Эффект пульсара для нейтронной звезды
                if (remnant.type === 'Нейтронная звезда') {
                    const pulse = 0.7 + 0.3 * Math.sin(simulationTime * 10);
                    currentColor = [
                        currentColor[0] * pulse,
                        currentColor[1] * pulse,
                        currentColor[2] * pulse
                    ];
                }
            }
            
            // Ограничение радиуса для отображения
            const displayRadius = Math.min(currentRadius, maxRadius);
            
            // Рисуем звезду/остаток
            drawRotatingStar(
                centerX, centerY,
                displayRadius,
                currentColor,
                rotationAngle,
                currentFlattening,
                isRemnant
            );
            
            // Обновление времени симуляции
            if (isSimulating && !isPaused && progress < 1) {
                simulationTime += 1/60; // 60 FPS
                animationId = requestAnimationFrame(animate);
            } else if (progress >= 1) {
                isSimulating = false;
            }
        }
        
        // Запуск симуляции
        function startSimulation() {
            if (isSimulating) return;
            
            applySliderValues();
            calculateRemnant();
            
            simulationTime = 0;
            isSimulating = true;
            isPaused = false;
            animate();
        }
        
        // Пауза/продолжение
        function togglePause() {
            isPaused = !isPaused;
            document.getElementById('pauseBtn').textContent = isPaused ? '▶ Продолжить' : '⏸ Пауза';
            
            if (isSimulating && !isPaused) {
                animate();
            }
        }
        
        // Сброс
        function resetSimulation() {
            isSimulating = false;
            isPaused = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            applySliderValues();
            
            // Сброс отображения
            currentRotationDisplay.textContent = star.rotationSpeed.toFixed(2) + ' об/день';
            finalRotationDisplay.textContent = '-';
            speedIncreaseDisplay.textContent = '-';
            remnantTypeDisplay.textContent = '-';
            
            // Рисуем начальное состояние
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawRotatingStar(
                canvas.width / 2, canvas.height / 2,
                Math.min(star.radius, canvas.width * 0.4),
                star.color,
                0,
                star.flattening
            );
        }
        
        // Инициализация
        initialMassSlider.addEventListener('input', updateSliderValues);
        initialRadiusSlider.addEventListener('input', updateSliderValues);
        rotationSpeedSlider.addEventListener('input', updateSliderValues);
        collapseFactorSlider.addEventListener('input', updateSliderValues);
        
        document.getElementById('startBtn').addEventListener('click', startSimulation);
        document.getElementById('pauseBtn').addEventListener('click', togglePause);
        document.getElementById('resetBtn').addEventListener('click', resetSimulation);
        
        resetSimulation();
    </script>
</body>
</html>
